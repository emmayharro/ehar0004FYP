%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                         Final Year Project                              %
%                               2020                                      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Written by: Emily Harrison (ID: 28761537)
% Supervised by: Dr Bill Corcoran

% PROJECT AIM: simulate an optical communications system that uses Optical
% Injection Locking to improve the reliability of the system

% THE PROJECT focuses on M-QAM signals, where M is between 4 and 64. It
% uses linewidths ranging from 1kHz to 100MHz.

% THIS SCRIPT was used to determine the effect of gap width on the most
% effective HWHM of the Lorentzian shaped filters.

%% Housekeeping
close all; clear all; clc;

% All graphs cover the following laser linewidths
Laser = [1e3, 1e4, 1e5, 2e5, 5e5, 8e5, 1e6, 2e6, 5e6, 8e6, 1e7, 2e7, 5e7, 8e7, 1e8];

%% 4-QAM

BERwo = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.003851, 0.49748, 0.49563, 0.49565];
Qwo = [28.0845, 27.9975, 27.245, 26.6873, 24.9296, 23.679, 23.1953, 20.843, ...
    17.3233, 15.4446, 14.4774, 10.5628, -2.9852, -2.987, -2.9672];

% Results from Lorentzian filer width = 0.1
BER4_L01 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 4.6964e-05, 0.0001996, 0.0072207, ...
    0.067604, 0.11878, 0.13813];
Q4_L01 = [27.0187, 26.9105, 26.1034, 25.1971, 22.9726, 22.0363, 21.0457, ...
    18.7712, 15.156, 13.5581, 12.4664, 9.9341, 5.8372, 3.9135, 3.1453];

% Results from first try of Lorentzian filter = width = 0.5
BER4_L05 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.00044616, 0.0078077, 0.070434, ...
    0.12637, 0.13845];
Q4_L05 = [26.9457, 26.8612, 25.9188, 25.0762, 23.1318, 21.8355, 21.2671, ...
    18.6536, 15.936, 13.5397, 12.3225, 9.8656, 5.785, 3.7203, 3.2057];

% Results from Lorentzian width = 1
BER4_L1 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 9.3928e-05, 0.00052834, 0.011342, ...
    0.073956, 0.12853, 0.14801];
Q4_L1 = [26.7252, 26.6446, 25.7151, 24.8969, 23.032, 21.9079, 21.3185, ...
    18.7498, 15.1734, 13.3364, 12.5269, 9.2843, 5.499, 3.5747, 3.0184];


%% 16-QAM
BER16_L01 = [0, 0, 0, 0, 0, 1.1741e-05, 3.5223e-05, 0.0013326, 0.012921, ...
    0.023828, 0.030333, 0.073187, 0.14602, 0.18214, 0.21077];
Q16_L01 = [24.1165, 24.0807, 23.5162, 22.9914, 21.7836, 20.9072, 20.2313, ...
    18.249, 14.9756, 13.4138, 12.6931, 9.3407, 5.5938, 4.0923, 2.9582];

BER16_L05 = [0, 0, 0, 0, 5.8705e-06, 4.6964e-05, 9.9798e-05, 0.0012445, ...
    0.010455, 0.027456, 0.030403, 0.073868, 0.14053, 0.45382, 0.19778];
Q16_L05 = [23.963, 23.9281, 23.4455, 22.9165, 21.7581, 20.6609, 20.0056, ...
    18.1616, 15.2268, 12.9758, 12.7243, 9.3596, 5.6913, -2.9497, 3.3958];

BER16_L1 = [0, 0, 0, 0, 0, 5.2834e-05, 7.0446e-05, 0.0010449, 0.012551, ...
    0.024357, 0.035651, 0.073915, 0.14742, 0.49909, 0.49905];
Q16_L1 = [23.6519, 23.6117, 23.1603, 22.6948, 21.4653, 20.4434, 19.9716, ...
    18.2681, 14.847, 13.3454, 12.2076, 9.2501, 5.4514, -2.992, -2.9955];


%% Recovery_compare
% Comparing standard phase-comp, brick-wall filter with phase-comp and
% Lorentzian filter with phase-comp over a subset of linewidths, most
% interested in higher linewidths (>10e7 Hz).

LaserSub = Laser([1,5,11:15]);

BER4_L = [0, 0, 0, 1.1741e-05, 0.00012915, 0.00099798, 0.0017846];
Q4_L = [18.2515, 18.1693, 16.7582, 15.6309, 13.7185, 12.0726, 11.4784];

BER16_L = [0.0020018, 0.0021662, 0.0051836, 0.0095571, 0.02259, 0.036655, 0.045854];
Q16_L = [17.6237, 17.5479, 16.3195, 15.2986, 13.4162, 11.9509, 11.2398];

BER64_L = [0.031548, 0.031865, 0.04449, 0.054678, 0.082132, 0.10177, 0.11248];
Q64_L = [17.3684, 17.2935, 16.0752, 15.2221, 13.1248, 11.8308, 11.1654];


BER4_BW = [0, 0, 0, 0.00032875, 0.0074438, 0.026147, 0.03581];
Q4_BW = [27.2963, 26.0118, 16.4, 13.7308, 9.9371, 8.0349, 7.3249];

BER16_BW = [0, 0, 0.0064106, 0.021879, 0.06879, 0.093986, 0.11421];
Q16_BW = [23.7033, 23.1058, 16.109, 13.535, 9.6017, 8.0571, 6.9971];

BER64_BW = [0.0011937, 0.001949, 0.046005, 0.079952, 0.13571, 0.17113, 0.18757];
Q64_BW = [22.4922, 22.0196, 15.9616, 13.2982, 9.778, 7.861, 7.085];


BER4_PC = [0, 0, 0.49625, 0.49576, 0.4957, 0.49609, 0.4981];
Q4_PC = [27.2447, 24.6119, -2.9886, -2.9797, -2.9821, -2.9803, -2.9913];

BER16_PC = [0, 0, 0.028366, 0.49949, 0.49795, 0.4715, 0.45536];
Q16_PC = [24.5425, 22.7668, 12.8949, -2.9855, -2.9992, -2.3466, -3.002];

BER64_PC = [0.00032875, 0.0020742, 0.45843, 0.49875, 0.49984, 0.27803, 0.4978];
Q64_PC = [23.464, 22.0544, -2.9313, -2.9964, -3.0345, 3.1894, -3.0013];

% subband gap = 2GHz instead of 1GHz - VERY similar (just BER =/= 0) for 16/64 QAM
BER4_L2 = [1.1741e-05, 0.00016437, 0.00084535];
Q4_L2 = [22.2704, 22.2745, 22.241, 22.1965, 22.0662, 21.9745, 21.8941, ...
    21.5408, 20.6566, 19.8223, 19.3903, 17.711, 15.0053, 13.2547, 12.3784];

BER4_BW2 = [0.0047199, 0.023552, 0.038076];
Q4_BW2 = [27.1648, 27.0884, 26.8513, 26.602, 25.9102, 25.4894, 25.048, ...
    22.4994, 19.1774, 17.4648, 16.5513, 13.9969, 10.3616, 8.1783, 7.303];

% subband gap = 2GHz and lorentzian = 0 outside this gap, HWHM = 0.5
BER4_L20 = [1.1741e-05, 0.00032875, 0.00075142];
Q4_L20 = [23.7932, 23.7748, 23.73, 23.7003, 23.516, 23.3633, 23.2601, ...
    22.7862, 21.5936, 20.7061, 20.1385, 18.1481, 15.189, 13.1989, 12.4125];

% subband gap = 1GHz and lorentzian =0 outside this gap, HWHM = 0.5
BER4_L10 = [0.00014089, 0.00059879, 0.0020077];
Q4_L10 = [24.5998, 24.5869, 24.4743, 24.449, 24.23, 23.9698, 23.8606, ...
    23.1232, 21.8405, 20.8528, 20.1396, 17.9851, 14.6213, 12.7117, 11.946];

% subband gap = 2GHz, lorentzian = 0 outside, HWHM = 1 (0.5*gap)
BER4_L201 = [0, 0, 0, 0, 1.1741e-05, 0, 0, 1.1741e-05, 1.1741e-05, ...
    2.3482e-05, 0, 3.5223e-05, 0.00029352, 0.00096276, 0.001949];
Q4_L201 = [15.5621, 15.5691, 15.5521, 15.5465, 15.5334, 15.52, 15.4912, ...
    15.4331, 15.3087, 15.1021, 14.9875, 14.5062, 13.3098, 12.2991, 11.7638];

% subband gap = 1GHz, lorentzian = 0 outside, HWHM = 0.25
BER4_L025 = [0.00015263, 0.0035223, 0.0057531];
Q4_L025 = [26.9872, 26.9644, 26.7714, 26.5611, 25.9532, 25.5435, 25.2329, ...
    23.8795, 21.1565, 19.7396, 19.0061, 16.3941, 12.9378, 10.8355, 10.1677];

BER4_L2025 = [0.0002583, 0.0024186,  0.0045672];
Q4_L2025 = [27.1169, 27.0807, 26.8845, 26.6783, 26.0604, 25.6033, 25.2711, ...
    23.8468, 21.4521, 19.8022, 19.189, 16.6556, 13.1486, 10.9999, 10.3327];

figure(8)
semilogx(LaserSub, Q4_L, LaserSub, Q16_L, LaserSub, Q64_L, LaserSub, Q4_BW, ...
    LaserSub, Q16_BW, LaserSub, Q64_BW, LaserSub, Q4_PC, LaserSub, Q16_PC, LaserSub, Q64_PC, Laser, Q4_L2)
legend('4 Lorentzian', '16 Lorentzian', '64 Lorentzian', '4 Brick Wall', ...
    '16 Brick Wall','64 Brick Wall', '4 Phasecomp', '16 Phasecomp', '64 Phasecomp', '4 Lorentzian 2GHz Gap')
legend('location', 'southwest')
xlabel('Linewidth (Hz)')
ylabel('Q')

figure(9)
semilogx(LaserSub, Q4_L, LaserSub, Q4_BW, LaserSub, Q4_PC, Laser, Q4_L2, ...
    Laser, Q4_BW2, Laser, Q4_L20, Laser, Q4_L10)
legend('Lorentzian', 'Brick Wall', 'Phasecomp', 'Lorentzian 2GHz Gap', ...
    'Brick Wall 2GHz Gap', 'Lorentzian=0 outside 2GHz gap', 'Lorentzian=0 outside 1GHz gap')
legend('location', 'southwest')
xlabel('Linewidth (Hz)')
ylabel('Q')
title('4 QAM')

figure(10)
semilogx(LaserSub, Q4_L, Laser, Q4_L2, Laser, Q4_L20, Laser, Q4_L10, ...
    Laser, Q4_L201, Laser, Q4_L025, Laser, Q4_L2025)
legend('Lorentzian 1GHz Gap', 'Lorentzian 2GHz Gap', 'Lorentzian=0 outside 2GHz gap HWHM=0.5', ...
    'Lorentzian=0 outside 1GHz gap HWHM=0.5', 'Lorentzian=0 outside 2GHz gap HWHM=1', ...
    'Lorentzian=0 ouside 1GHz gap HWHM=0.25', 'Lorentzian=0 ouside 2GHz gap HWHM=0.25')
legend('location', 'southwest')
xlabel('Linewidth (Hz)')
ylabel('Q')
title('4 QAM')